<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="icon"
    type="image/svg+xml"
    href="data:image/jpeg;base64,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"
  />
  <title>LeetCode Question Dashboard</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-blue-50 to-white px-8 py-10">

  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">
      ðŸ“Š LeetCode Question Dashboard
    </h1>

    <div class="flex flex-col sm:flex-row sm:items-center justify-center gap-4 mb-6">
      <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-md shadow-md transition">
        Upload CSV
        <input type="file" accept=".csv" class="hidden" id="fileInput" />
      </label>

      <input
        type="text"
        id="companyInput"
        placeholder="Enter Company Name"
        class="px-4 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200"
      />

      <button
        id="resetButton"
        class="hidden bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-md shadow-md transition"
      >
        Reset Dashboard
      </button>
    </div>

    <h2 id="companyTitle" class="hidden text-xl font-semibold text-blue-600 mb-3 text-center"></h2>

    <div id="tableContainer" class="mt-10">
      <p class="text-center text-gray-500 text-lg">Upload your CSV file to get started.</p>
    </div>
  </div>

  <div id="notesModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl transform transition-transform duration-300 scale-95">
      <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
        <h3 id="modalTitle" class="text-lg font-semibold text-gray-800">Notes</h3>
        <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <div class="p-4">
        <textarea id="modalNotesTextarea" class="w-full h-96 p-3 bg-gray-800 text-gray-200 font-mono text-sm rounded-md border border-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none" placeholder="Add your code snippets and notes here..."></textarea>
      </div>
      <div class="p-4 border-t flex justify-end gap-3 bg-gray-50 rounded-b-lg">
        <button id="cancelModalBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md transition">Cancel</button>
        <button id="saveNotesBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md shadow-md transition">Save Notes</button>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const companyInput = document.getElementById('companyInput');
    const resetButton = document.getElementById('resetButton');
    const tableContainer = document.getElementById('tableContainer');
    const companyTitle = document.getElementById('companyTitle');

    // âœ… Modal elements
    const notesModal = document.getElementById('notesModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalNotesTextarea = document.getElementById('modalNotesTextarea');
    const saveNotesBtn = document.getElementById('saveNotesBtn');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');

    let questions = JSON.parse(localStorage.getItem('questionData') || '[]');
    let company = localStorage.getItem('companyName') || '';
    let progress = JSON.parse(localStorage.getItem('progress') || '{}');

    // On load, merge saved progress into saved questions
    if (questions.length > 0) {
      questions = questions.map((q, i) => ({
        ...q,
        id: i,
        done: progress[i]?.done || false,
        notes: progress[i]?.notes || ""
      }));
      renderTable(questions);
      resetButton.classList.remove('hidden');
    }

    if (company) {
      companyInput.value = company;
      companyTitle.textContent = 'ðŸ“Œ Company: ' + company;
      companyTitle.classList.remove('hidden');
    }

    // Company input
    companyInput.addEventListener('input', (e) => {
      company = e.target.value;
      localStorage.setItem('companyName', company);
      companyTitle.textContent = 'ðŸ“Œ Company: ' + company;
      companyTitle.classList.toggle('hidden', !company);
    });

    // Upload CSV
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: (results) => {
          questions = results.data.map((q, i) => ({
            ...q,
            id: i,
            done: progress[i]?.done || false,
            notes: progress[i]?.notes || ""
          }));
          localStorage.setItem('questionData', JSON.stringify(questions));
          renderTable(questions);
          resetButton.classList.remove('hidden');
        },
      });
    });

    // Reset Dashboard
    resetButton.addEventListener('click', () => {
      localStorage.removeItem('questionData');
      localStorage.removeItem('companyName');
      localStorage.removeItem('progress');
      questions = [];
      company = '';
      progress = {};
      companyInput.value = '';
      companyTitle.classList.add('hidden');
      resetButton.classList.add('hidden');
      tableContainer.innerHTML = '<p class="text-center text-gray-500 text-lg">Upload your CSV file to get started.</p>';
    });

    // Save progress
    function updateProgress(updated) {
      const store = {};
      updated.forEach((r) => (store[r.id] = { done: r.done, notes: r.notes }));
      localStorage.setItem('progress', JSON.stringify(store));
      progress = store;
    }
    
    // âœ… Modal Functions
    function openNotesModal(questionId) {
        const question = questions[questionId];
        modalTitle.textContent = `Notes for: ${question.Title}`;
        modalNotesTextarea.value = question.notes || '';
        // Store the ID on the modal itself to know which question to save later
        notesModal.dataset.currentId = questionId; 
        notesModal.classList.remove('hidden');
        // For animation
        setTimeout(() => {
            notesModal.querySelector('div').classList.remove('scale-95');
            notesModal.classList.remove('opacity-0');
        }, 10);
    }
    
    function closeNotesModal() {
        // For animation
        notesModal.querySelector('div').classList.add('scale-95');
        notesModal.classList.add('opacity-0');
        setTimeout(() => notesModal.classList.add('hidden'), 300);
    }
    
    // âœ… Event listeners for modal buttons (added once)
    saveNotesBtn.addEventListener('click', () => {
        const id = parseInt(notesModal.dataset.currentId);
        if (isNaN(id)) return;
        questions[id].notes = modalNotesTextarea.value;
        updateProgress(questions);
        closeNotesModal();
    });

    closeModalBtn.addEventListener('click', closeNotesModal);
    cancelModalBtn.addEventListener('click', closeNotesModal);
    notesModal.addEventListener('click', (e) => { // Close on backdrop click
        if (e.target === notesModal) {
            closeNotesModal();
        }
    });

    // Render table
    function renderTable(data) {
      if (!data.length) return;
      const headers = ["#","Done","Difficulty","Title","Frequency","Acceptance Rate","Link","Topics","Notes"];
      let html = `
        <div class="overflow-x-auto bg-white shadow-xl rounded-lg">
        <table class="w-full text-sm text-left text-gray-700">
          <thead class="text-xs uppercase bg-blue-100 text-blue-800">
            <tr>
              ${headers.map(h => `<th class="px-4 py-3">${h}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            ${data.map((q, i) => `
              <tr class="border-b hover:bg-blue-50 transition ${q.done ? 'bg-blue-50' : 'bg-white'}" data-id="${i}">
                <td class="px-4 py-3 font-semibold text-gray-500">${i + 1}</td>
                <td class="px-4 py-3">
                  <input type="checkbox" class="doneCheck h-4 w-4 text-blue-600 rounded focus:ring-blue-500" ${q.done ? 'checked' : ''}>
                </td>
                <td class="px-4 py-3 font-semibold">${q.Difficulty || ''}</td>
                <td class="px-4 py-3">${q.Title || ''}</td>
                <td class="px-4 py-3">${q.Frequency || ''}</td>
                <td class="px-4 py-3">${q["Acceptance Rate"] ? (q["Acceptance Rate"]*100).toFixed(2)+'%' : ''}</td>
                <td class="px-4 py-3">
                  <a href="${q.Link || '#'}" target="_blank" rel="noreferrer" class="text-blue-600 hover:underline">Open</a>
                </td>
                
                <td class="px-4 py-3 align-top">
                  ${q.Topics && q.Topics.trim() ? `
                    <button class="toggle-topics flex items-center gap-1 text-blue-600 hover:text-blue-800">
                      <span class="font-medium">View</span>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </button>
                    <div class="topics-container hidden mt-2 flex flex-wrap gap-1">
                      ${q.Topics.split(',').map(topic => topic.trim() ? `<span class="bg-gray-200 text-gray-700 text-xs font-medium px-2 py-0.5 rounded-full">${topic.trim()}</span>` : '').join('')}
                    </div>
                  ` : '<span class="text-gray-400">N/A</span>'}
                </td>
                
                <td class="px-4 py-3">
                  <button class="open-notes-modal-btn bg-gray-200 hover:bg-gray-300 text-gray-800 text-xs font-semibold py-1 px-3 rounded-md transition">
                    View / Edit
                  </button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        </div>
      `;
      tableContainer.innerHTML = html;

      // Event listeners for each row
      tableContainer.querySelectorAll('tr[data-id]').forEach(row => {
        const id = parseInt(row.dataset.id);
        const checkbox = row.querySelector('.doneCheck');
        
        // Topics toggle button
        const topicsButton = row.querySelector('.toggle-topics');
        if (topicsButton) {
          const topicsContainer = row.querySelector('.topics-container');
          const arrowIcon = topicsButton.querySelector('svg');
          topicsButton.addEventListener('click', () => {
            topicsContainer.classList.toggle('hidden');
            arrowIcon.classList.toggle('rotate-180');
          });
        }
        
        checkbox.addEventListener('change', () => {
          data[id].done = checkbox.checked;
          row.classList.toggle('bg-blue-50', checkbox.checked);
          if (!checkbox.checked) {
              row.classList.remove('bg-white'); // ensure it goes back to default if needed
          }
          updateProgress(data);
        });

        // âœ… MODIFIED: Event listener for the new "View / Edit" notes button
        const notesButton = row.querySelector('.open-notes-modal-btn');
        notesButton.addEventListener('click', () => {
            openNotesModal(id);
        });
      });
    }
  </script>
</body>
</html>
